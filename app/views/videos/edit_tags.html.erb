<link type="text/css" href="/javascripts/css/ui-lightness/jquery-ui-1.8.16.custom.css" rel="stylesheet" />
<script type="text/javascript" src="/javascripts/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="/javascripts/js/jquery-ui-1.8.16.custom.min.js"></script>

<head>
	<title>VtagO - <%= @page_title %></title>
	<script>
	$(document).ready(function(){

		//$('.gallery_delete').hide();
		$('.edit_box').hover(function(){			
			//$(this).find('.gallery_delete').show();
			
		});

});
</script>
</head>

<body>
	<!--Content Section -->
	<div id="content_sec">
		<div id="left_content">
			<div class="video-category" id="tab1">
				<div class="heading-list">
					<h1><%= @page_title %></h1>
				</div>
				
				<% if @video.video_taggees.any? %>
					<div class="wrapper_list_view">
						<%= form_for :video, :url => "/video/#{@video.id}/update_tags#{"/new" if @new}" do |f| %>
							<div id="video_taggees">
								<table  id="edit_tags_wrappper"><tr><td>
								<% @video.video_taggees.each do |video_taggee| %>
								<%gallery_class_helper%>
									<div class="edit_box radious_6 <%= @dynamic_class%>" id="video_taggee<%= video_taggee.id.to_s %>">
										<%= fields_for_taggee(video_taggee) do |tag| %>
											<div id="face_tag" class="ui-widget">
												<%= link_to_function  image_tag("gallery_delete.png", :class=>'gallery_delete'), "var node1 = document.getElementById(\'video_taggee#{video_taggee.id.to_s}\');node1.parentNode.removeChild(node1)" %>
												<br>
												<div class="image_border radious_6"><img class="gallary_image" src="<%= "#{video_taggee.img_path}" %>" width="70" height="80"></div>
												
												<label for="tags">Who is this? </label>
												<br>
												<%= tag.text_field 	 :contact_info, :class => "contact_info" %>
												<br>
												<%= tag.hidden_field :fb_id, :class =>"fb_id" %>
												
											</div>
										
										<% end %>
									</div>
									
								<% end %>
								<div class="edit_box radious_6">
									<%= link_to  image_tag("gallery_delete.png", :class=>'gallery_delete') %>
									<div class="avatar_border radious_6"><%=image_tag "avatar.png", :size=>'70x80'%></div>
									<label for="tags">Add another Vtag</label>
									 <br>
									<input type="text" class="contact_info">
								

								</div> 
								
								</td></tr></table>
								<br class="clear" />
								<div>
									<p><input class="vtag_butt" type="submit" onclick = "update_fb_ids();" value="Update video" name="commit"></p>
								</div>
							</div>
						<% end %>
					</div>
				<% else %>			
					<h2> Sorry, no faces found in this video </h2>
					<br class="clear" />
					<div>
						<p><input type="button" onclick="location.href='<%= @video.uri %>'" value="Back" name="back"></p>
					</div>		
				<% end %>
			</div>
		</div>
		<%= render :partial => "sidebars/single_video_sidebar" %>
    <br class="clear" />
	</div>
    	<!--Content Section End -->
 </div>
</body>


<script type="text/javascript">
$(function() {
	var availableTags = <%= raw @names_arr.to_json %>;
	var contacts = document.getElementsByClassName("contact_info");
	$(contacts).autocomplete({
		source: availableTags
	});
});

var friends_hash = <%= raw @friends.to_json %>;
function update_fb_ids(){
	$(".contact_info").each (function() {
		var fb_id_field = $(this).next()
		fb_id_field.val(friends_hash[$(this).val()]);
	});
}
</script>