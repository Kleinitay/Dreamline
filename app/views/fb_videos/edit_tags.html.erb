<head>
	<link type="text/css" href="/javascripts/css/ui-lightness/jquery-ui-1.8.16.custom.css" rel="stylesheet" />
<script type="text/javascript" src="/javascripts/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="/javascripts/js/jquery-ui-1.8.16.custom.min.js"></script>
</head>
<div class="vtag_video wrapper">
	<h2>Edit Tags</h2>
		<div class="video_list">
		<% if @video.video_taggees.any? %>
				<%= form_for :video, :url => "/fb/#{@video.fbid}/update_tags#{"/new" if @new}" do |f| %>
					<div id="video_taggees">
						<% @video.video_taggees.each do |video_taggee| %>
							<div id="video_taggee<%= video_taggee.id.to_s %>">
							    <%= fields_for_taggee(video_taggee) do |tag| %>
							        <div id="face_tag" class="ui-widget">
							            <img src="<%= "#{video_taggee.img_path}" %>" width="60" height="70">
													<label for="tags">Who is this? </label>
							            <%= tag.text_field 	 :contact_info, :class => "contact_info" %>
							            <%= tag.hidden_field :fb_id, :class =>"fb_id" %>
													<%= link_to_function "remove", "var node1 = document.getElementById(\'video_taggee#{video_taggee.id.to_s}\');node1.parentNode.removeChild(node1)" %>
							        </div>
							    <% end %>
							</div>
						<% end %>
					</div>
	
					<div id="edit_submit">
						<p><input  class="vtag_but radious_6" type="submit" onclick = "update_fb_ids();" value="Update video" name="commit"></p>
					</div>
				<% end %>
			<% else %>
				<div id="not_found_tags">
					<h2> Sorry, no faces found in this video </h2>
				</div>
				<div id="not_found_tags_back">
						<input class="vtag_butt radious_6" type="button" onclick="location.href='/fb/list'" value="Back" name="Back">
				</div>	
				
			<% end %>
		</div>
		<div id="right_content">
			<%#= render :partial => "sidebars/single_video_sidebar" %>
		</div>
</div>


<script type="text/javascript">
	
	$(function() {
		var availableTags = <%= raw @names_arr.to_json %>;
		var contacts = document.getElementsByClassName("contact_info"); //no longer nedded 
		
		//this function display the JQuery ui autocomplite+image
		$(".contact_info").each(function() {
			$(this).autocomplete({
				source: availableTags
			}).data("autocomplete")._renderItem = function (ul, item) { // this section was added by pnina this is the place where the image is added to the autocomplite
				return $("<li />")
				.data("item.autocomplete", item)
				.append("<a><img src='https://graph.facebook.com/1460357077/picture/' width='23' height='23'>" + item.value + "</a>")
				.appendTo(ul);
			}; //data
		});	
	});

	var friends_hash = <%= raw @friends.to_json %>;
	function update_fb_ids(){
		$(".contact_info").each (function() {
			var fb_id_field = $(this).next()
			fb_id_field.val(friends_hash[$(this).val()]);
		});
  }
</script>